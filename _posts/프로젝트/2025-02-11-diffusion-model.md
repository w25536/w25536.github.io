---
title: "[팀프로젝트] 마지막 논문 "
last_modified_at: 2025-02-11
categories:

tags:
  - python
  - 파이썬
  - torchtext
  - pytorch
  - 파이토치
  - 전처리
  - data science
  - 데이터 분석
  - 딥러닝
  - 딥러닝 자격증
  - 머신러닝
  - 빅데이터
excerpt: "[팀프로젝트] 마지막 논문  정리"
use_math: true
classes: wide
---

## 논문 정리

벽화는 과거부터 도시 경관을 개선하고 지역 사회의 정체성을 형성하고 표현하는 시각적 요소로 사용되어 왔다. 공공 예술의 한 형태로서 공간을 재해석하고 공동체 간의 유대감을 형성하는데 기여하지만, 전문적인 디자인 기술과 많은 시간 및 비용이 요구되는 점에 있어서 일반인의 접근이 쉽지 않다. 또한 벽화 제작 과정에서는 클라이언트 측의 의뢰와 회사 측의 피드백 과정이 필수적이지만, 단순히 글이나 말로 표현하거나 익숙하지 않은 디자인 툴을 사용해 피드백을 진행하는 등의 효율적이지 못하고 복잡한 과정을 가지고 있다.

 최근 AI기술의 발전으로 이미지 생성 모델과 세그멘테이션 기술을 활용해 벽화 디자인을 보다 효율적으로 생성하고 시각화할 수 있는 가능성이 열리고 있다. 특히 Stable Diffusion[1] 모델은 사용자의 텍스트 입력, 스케치 등의 입력을 기반으로 고유한 스타일의 디자인을 생성할 수 있으며, SegFormer[2] 같은 세그멘테이션 모델은 주어진 공간에서 벽의 위치를 자동으로 식별하여 보다 정밀한 적용이 가능하다. 또한 LLM을 활용하여 사용자의 추상적인 아이디어를 구체적인 조건으로 변환하여 원하는 이미지를 정확하게 생성할 수 있다.

 현재의 벽화 디자인 과정은 디지털 도구를 활용하는 경우가 많지만, 벽의 위치와 형태를 자동으로 인식하고, AI 기반 이미지 생성 기술을 접목하는 솔루션은 부족한 상황이다. 기존의 그래픽 디자인 소프트웨어는 많은 비용과 전문적인 기술을 요구하며, 단순한 이미지 생성 AI는 사용자의 요구를 반영한 세밀한 디자인을 제공하기 어렵다. 이에 벽화 디자인을 보다 직관적으로 생성하고 공유할 수 있는 AI 기반 서비스의 필요성이 증가하고 있다.

 본 논문에서는 이러한 과정을 해결하기 위해 AI기반의 생성 플랫폼인 벽화 디자인 생성 서비스 어플리케이션을 제안한다. 이 어플리케이션은 주어진 사진에 사용자가

의도한 벽화 디자인을 적용시키고 소통할 수 있는 기증을 제공함으로서 디자인 과정에서 발생하는 문제를 적은 비용, 기간으로 해결할 수 있다. 논문의 구성은 다음과 같다. 2장에서는 기존의 벽화 디자인 프로세스를 분석한다. 3장에서는 제안하는 어플리케이션의 설계와 주요 기능을 설명하며, 4장에서는 디자인 서비스의 핵심인 Stable Diffusion, SegFormer, LLM, LoRA 학습 방법[3]에 대하여 기술한다. 5장에서는 어플리케이션의 구현과 실험결과를 설명하고, 마지막으로 6장에서 결론을 제시한다.

---

SegFormer는 계층적인 Transformer 인코더와 경량 MLP 디코더로 구성된 혁신적인 이미지 세분화 모델이다. 다중 스케일 특징을 효과적으로 출력하는 이 모델은 위치 인코딩이 필요하지 않아 성능 저하를 방지하는 장점을 갖고 있다. 특히 경량화된 MLP 디코더는 불필요한 복잡성을 제거하면서도 여러 계층에서 정보를 효율적으로 수집하여 지역적 특성과 전역적 주의력을 균형 있게 결합한다. 단순하고 효율적인 설계 철학을 바탕으로 한 SegFormer는 다양한 규모로 확장 가능하며, 실제로 SegFormer-B4 모델은 ADE20K 데이터셋에서 50.3%의 mIoU를 기록했고, 더 큰 규모의 SegFormer-B5는 Cityscapes 검증 세트에서 84.0%라는 우수한 성능을 달성하였다. 기존의 ImageNet 사전학습된 ResNet-50 인코더나 Dilated ResNet-50 기반 End-to-End 학습 방식과 비교했을 때, SegFormer는 더 높은 정확도와 효율성을 제공하여 벽 영역 세그멘테이션에 더 적합한 모델로 선정되었다. 특히 복잡한 텍스처와 다양한 조명 조건이 존재하는 실제 환경에서의 벽면 인식에 있어 기존 모델들보다 우수한 성능을 보여주기 때문에 본 연구의 벽화 디자인 시스템에 채택하게 되었다.

마스크 공정 과정에서는 실제 벽화 디자인을 적용할 벽 영역을 정확히 식별하기 위해 SegFormer 모델 기반 이미지 세그멘테이션을 수행한다. 먼저 벽화 디자인을 적용할 대상 이미지 파일을 특정 디렉토리에서 선택하여 로드한다. 이후 'nvidia/segformer-b4-finetuned-ade-512-512' 모델과 이미지 프로세서를 불러와 작업을 준비한다. 로드된 이미지는 PyTorch 텐서 형태로 전처리되어 모델 입력으로 사용된다. 입력 데이터를 SegFormer 모델에 전달하여 추론을 수행하면, 각 픽셀에 대한 클래스별 예측 점수(logits)가 출력된다. 이 결과를 후처리하여 원본 이미지 크기에 맞는 세그멘테이션 마스크를 생성한다. 생성된 마스크는 각 픽셀마다 특정 클래스 ID가 할당된 다중 클래스 형태를 갖는다. 벽화 디자인 적용을 위해서는 '벽' 클래스에 해당하는 영역만을 추출하여 이진(binary) 마스크로 변환하는 과정이 필요하다. 이를 위해 모델의 클래스 ID와 라벨 매핑 정보를 활용하여 '벽' 클래스의 ID를 식별하고, 해당 클래스에 속하는 픽셀을 1로, 나머지 픽셀을 0으로 설정한 이진 마스크를 생성한다. 추가적으로, 세그멘테이션 결과에서 탐지된 각 클래스의 픽셀 수를 계산하여 출력함으로써, 이미지 내 벽 영역뿐 아니라 다른 객체들의 분포도 함께 파악할 수 있다. 이러한 과정을 통해 벽 영역의 정확한 위치와 형태를 시각적으로 확인하고, 이후 벽화 디자인을 정밀하게 적용할 수 있는 기반을 마련한다.

본 연구에서 SegFormer 모델을 활용한 semantic segmentation 장점은 벽 영역뿐만 아니라 사용자가 원하는 다양한 객체나 영역을 자유롭게 선택하여 벽화 디자인을 적용할 수 있도록 하기 위함이다. 사용자가 원하는 특정 객체나 영역을 선택하면, 해당 영역에 대한 세그멘테이션 마스크를 자동으로 생성하고 이를 기반으로 스테이블 디퓨전을 이용한 인페인팅(inpainting) 기법을 수행하는 파이프라인을 구축하였다. 이를 통해 벽화 디자인 적용 대상이 벽에만 국한되지 않고, 사용자의 다양한 요구사항을 반영하여 보다 창의적이고 유연한 디자인 프로세스를 지원할 수 있다. 스테이블 디퓨전(Stable Diffusion)은 이미지 생성 모델로, 텍스트 입력을 기반으로 원하는 이미지를 생성해주는 '텍스트-이미지 생성' 모델 중 하나이다. 이 모델은 Forward Process와 Reverse Process를 통해 이미지를 생성한다. Forward Process에서는 원본 이미지에 가우시안 노이즈를 점차적으로 더해주고, Reverse Process에서는 이를 제거하면서 원본 이미지의 확률 분포와 유사해지도록 복원하는 과정을 수행한다. 스테이블 디퓨전은 대규모 데이터셋을 활용한 사전 훈련 과정에 많은 리소스가 소요되며, 본 연구에서는 이미 학습된 모델을 불러와 사용하므로 내부 구조나 세부 알고리즘 단계에 대한 설명은 본 논문의 범위를 벗어나 생략하도록 한다. 대신 실제 응용 측면에서 스테이블 디퓨전이 벽화 디자인에 어떻게 활용되는지에 초점을 맞추고자 한다.

[스테이블 디퓨전 간략한 이미지 생성 결과 첨부]

스테이블 디퓨전은 강력한 이미지 생성 능력을 제공하지만, 모든 벽화 디자인 요구사항을 충족시키기에는 몇 가및 한계점이 존재한다. 우선, 디퓨전 모델이 생성하는 이미지는 사용자가 세부적으로 제어하기 어려운 측면이 있으며, 특히 복잡한 디테일, 신체의 얼굴 표정 및 인체의 손 부분 등에 오류가 발생하는 경우도 많다. 이러한 한계점을 극복하기 위해 PEFT(Parameter-Efficient Fine-Tuning) 방식의 LoRA(Low-Rank Adaptation) 기법을 추가적으로 활용하여 원하는 벽화 스타일이 정확히 시뮬레이션 되도록 과정을 구성했다. LoRA는 사전 훈련된 스테이블 디퓨전 모델에 적은 양의 데이터로 특정 스타일이나 개념을 효율적으로 학습시킬 수 있는 기법으로, 전체 모델 파라미터를 미세조정하는 대신 저차원 행렬을 통해 가중치 업데이트를 수행함으로써 학습 효율성을 크게 향상시킨다. 본 연구에서는 벽화 디자인의 품질과 일관성을 향상시키기 위해 6가지 테마별 LoRA 모델을 구축하였다. 선정된 테마는 각 벽화 디자인에서 널리 활용되는 주요 예술 스타일을 대표한다. 각 테마별로 약 20-30장의 고품질 이미지를 수집하여 학습 데이터셋을 구성하였으며, 학습 파라미터는 학습률 1e-4, 배치 크기 1, 에폭 수 100으로 설정하여 최적화를 진행하였다. LoRA 학습을 통해 스테이블 디퓨전 모델은 각 테마의 고유한 시각적 특성을 효과적으로 학습하였으며, 이를 통해 사용자가 원하는 테마에 맞는 벽화 디자인을 더욱 정확하게 생성할 수 있게 되었다. 특히 주목할 만한 점은 학습된 모델이 아기자기하고 복잡하지 않은 디자인을 효과적으로 생성할 수 있었다는 것이다. 이러한 단순하면서도 매력적인 디자인은 공공 공간에서의 접근성과 시인성을 높이는 데 기여하며, 다양한 연령층이 쉽게 이해하고 공감할 수 있는 벽부 제작에 적합한 결과를 도출하였다.

<llm 내용 어딘가에 들어가야함>라

[학습한 이미지 및 결과 이미지 첨부]

다음은 스테이블 디퓨전을 활용한 벽화 디자인의 품질을 더욱 향상시키기 위한 추가적인 방안으로 ControlNet에 대한 설명이다. 본 실험에서는 ControlNet을 적용하여 디자인의 정밀한 배치와 형태를 제어함으로써 결과물을 고도화하는 작업을 진행하였다. ControlNet은 스테이블 디퓨전 모델의 이미지 생성 과정을 정밀하게 제어하는 기술로, "학습 가능한 복사본"과 "잠긴 복사본(자물쇠)"으로 매개변수를 분리하여 효율적인 학습과 안정적인 생성을 동시에 달성한다[논문 인용]. 특히 Zero convolution이라는 핵심 기술 요소를 통해 초기 가중치 값을 0으로 설정하고 역전파를 통해 점진적으로 학습함으로써, 기존에 학습된 의미론적 지식을 보존하면서도 새로운 조건에 적응할 수 있는 능력을 제공한다. 이러한 구조적 특징을 바탕으로 사용자가 제공한 스케치나 레이아웃 가이드에 따라 벽화 디자인의 구조와 배치를 정확히 조절할 수 있으며, 특히 불규칙한 벽면이나 복잡한 주변 환경에서도 원본 이미지의 실루엣과 구조적 특성을 보존하면서 자연스러운 디자인 조정이 가능하도록 구현 할 수 있다. 본 연구에서 구현한 ControlNet 기반 벽화 디자인 시스템의 파이프라인은 다음과 같이 세부적으로 구성되었다. 먼저 SegFormer 모델을 다해 정확하게 벽면 영로을 분할한 후, 해당 마스크 영역 내에서 canny edge 검출 알고리즘을 적용하여 벽면의 경계와 주요 구조적 특징을 파악한다. 이 경계 정보는 ControlNet의 입력으로 사용되어 생성되는 벽화 디자인이 벽면의 기하학적 구조를 따르도록 유도하여 디자인의 품질과 현실감을 크게 향상시킬 수 있었다

마지막으로 본 연구에서는 어플리케이션 구현 과정에서 리소스 제약으로 인해 구현하지 못한 추가적인 방법론을 제안하고자 한다. RePaint 기반의 인페인팅 알고리즘을 적용하여 생성된 디자인을 원본 이미지와 자연스럽게 통합하는 과정은 리소스 한계로 인해 구현하지 못하였다. 이 방법은 이미지의 알려진 영역과 생성된 영역 간의 자연스러운 통합을 가능하게 한다. 이상적인 구현 방안으로는 Canny edge ControlNet을 적용한 후 생성된 이미지를 벽면 영역에 배치하고, RePaint 알고리즘을 통해 추가적인 리샘플링 과정을 수행하는 것이다. 이러한 접근법은 벽화 디자인의 현실감과 통합성을 크게 향상시킬 수 있을 것으로 예상된다. 특히 벽면의 질감이나 불규칙한 표면에도 자연스럽게 적용되는 효과를 구현할 수 있어, 사용자가 벽화의 최종 모습을 보다 현실적으로 예측하는 데 도움이 된다. 이외에도 SegFormer 하이퍼파라미터 튜닝을 통해 벽의 정교한 인식 정확도를 높이는 방법과 증강현실 기술을 활용하여 사용자가 실제 벽에 적용된 벽화 이미지를 실시간으로 확인할 수 있는 기능도 향후 연구 방향으로 고려할 수 있다.





![[image-20180704141344201.png]]